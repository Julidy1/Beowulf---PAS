<?php
$this->headTitle('Social network analytical data provided via Google Analytics');
?>
<h2><?php echo $this->title();?></h2>

<p>
<?php 
$timespans = array(
'this week' => 'thisweek',
'last week' => 'lastweek',
'this month' => 'thismonth',
'last month' => 'lastmonth',
'this year' => 'thisyear',
'last year' => 'lastyear'
);
foreach($timespans as $k => $v):
?>
<a class="btn btn-small" href="<?php echo $this->url(array('module' => 'analytics','controller' => 'social','action' => 'activities', 'timespan' => $v),'default',false);?>"><?php echo ucfirst($k);?></a>
<?php endforeach;?> 

</p>
<?php 
if((int)$this->results->totalResults->text > 0 ):?>
<table class="table table-striped">
	<caption>Visitors over the timespan of: </caption>
		<thead>
		<tr>
			<th>URL</th>
			<th>Action</th>
			<th>Endorsing url</th>
			<th>Visitors</th>
		</tr>
		</thead>
		<tbody>
			<?php foreach($this->results as $row):?>
			<tr>
				<td><?php echo $row->getDimension(Zend_Gdata_Analytics_DataQuery::DIMENSION_SOCIAL_ACTIVITY_CONTENT_URL)->value;?></td>
				<td><?php echo $row->getDimension(Zend_Gdata_Analytics_DataQuery::DIMENSION_SOCIAL_ACTIVITY_NETWORK_ACTION)->value;?></td>
				<td><?php $url = parse_url($row->getDimension(Zend_Gdata_Analytics_DataQuery::DIMENSION_SOCIAL_ACTIVITY_ENDORSING_URL)->value);?>
				<?php
				if(array_key_exists('host', $url)){ 
				echo $url['scheme'] . '://' . $url['host'];
				} else {
				echo 'Not set';
				}?></td>
				<td><?php echo $row->getMetric(Zend_Gdata_Analytics_DataQuery::METRIC_SOCIAL_ACTIVITIES)->value;?></td>
			</tr>
			<?php endforeach;?>
		</tbody>
</table>
<?php else:?>
<p>No data can be retrieved that meets these criteria.</p>
<?php endif;?>
