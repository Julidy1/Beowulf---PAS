<?php 
$results = array();

foreach($this->results as $result){
	
	if(array_key_exists('description',$result)){
	$description = trim(preg_replace( '/\s+/', ' ',$result['description']));
	$result['description'] = $description;
	} else {
	$result['description'] = 'No description available';	
	}
	$geoJson = '';
	if(!array_key_exists('thumbnail',$result)){
	unset($result['imagedir']);
	unset($result['thumbnail']);
	unset($result['filename']);	
	}
	if(isset($result['knownas'])){
		unset($result['parish']);
		unset($result['fourFigure']);
		unset($result['fourFigureLat']);
		unset($result['fourFigureLon']);
	} 
	if(isset($result['fourFigure'])){
		$geoJson['type']['Feature']['geometry'] = array(
		'type' => 'Point',
		'coordinates' => array(
		$result['fourFigureLon'],
		$result['fourFigureLat'],
		)
		);
	} else {
		$geoJson['type']['Feature']['geometry'] = array(
		'type' => 'Point',
		'coordinates' => array(
		NULL,
		NULL
		)
		);
	}
	
	$geoJson['properties'] = $result;
	
	
	$results[] = $geoJson;
	
}
$meta = array( 
	'currentPage' => $this->paginator->getCurrentPageNumber(), 
	'totalResults' => $this->paginator->getTotalItemCount(), 
	'resultsPerPage' => $this->paginator->getItemCountPerPage(),
);
echo Zend_Json::prettyPrint(Zend_Json::encode(( 
	array(
//	'meta' => $meta, 
	'type' => 'FeatureCollection',
	'features' =>  $results
	)))
	);
